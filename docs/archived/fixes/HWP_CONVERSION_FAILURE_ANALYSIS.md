# HWP/HWPX 파일 변환 실패 상세 분석 보고서

**분석 일시**: 2025-11-18 13:14:10
**작업 디렉토리**: /mnt/d/workspace/sources/classfy_scraper

---

## 요약 (Executive Summary)

HWP/HWPX 파일 변환 과정에서 발생한 에러를 분석한 결과, 주요 문제는 **확장자가 .hwp인 파일을 HWPX 포맷으로 잘못 처리**하려는 시도에서 발생합니다.

### 핵심 발견사항

1. **총 1,356건의 에러 발생** (211개의 고유 파일)
2. **주요 에러**: 'Invalid HWPX file format' (678건, 전체의 50%)
3. **에러의 77.9%는 .hwp 파일**을 HWPX로 처리하려는 시도에서 발생
4. **122개 파일의 경로 정보 확인** (57.8%)

---

## 1. 통계 분석

### 1.1 전체 통계

| 항목 | 수량 |
|------|------|
| 총 에러 발생 횟수 | 1,356 |
| 고유 파일 수 | 211 |
| 경로 정보 확인된 파일 | 122 (57.8%) |
| 경로 정보 미확인 파일 | 89 (42.2%) |

### 1.2 에러 유형별 분석

| 에러 유형 | 발생 횟수 | 고유 파일 수 |
|----------|----------|-------------|
| Invalid HWPX file format | 678 | 211 |
| ㄴ .hwp 파일 (잘못된 처리) | 528 | 160 |
| ㄴ .hwpx 파일 (실제 에러) | 150 | 51 |

---

## 2. 근본 원인 분석 (Root Cause Analysis)

### 2.1 에러 발생 메커니즘

**코드 경로**: `src/utils/convertUtil.py`

```python
# Line 2574-2576: .hwp 파일 처리 중 HWPX fallback
# 3단계: HWPX fallback 시도 (.hwp 확장자지만 실제로는 HWPX일 가능성)
logger.info(f"HWPX fallback 시도: {hwp_file_path.name}")
return _convert_hwpx_file_to_html(hwp_file_path, output_dir)

# Line 2912: gethwp 라이브러리 호출 - 여기서 에러 발생
extracted_text = gethwp.read_hwpx(str(hwpx_file_path))
```

### 2.2 처리 흐름

1. **1단계**: HWP5 (OLE2) 포맷으로 처리 시도 → 실패
2. **2단계**: gethwp.read_hwp()로 구형 HWP 포맷 처리 시도 → 실패
3. **3단계**: HWPX fallback 시도 → **여기서 에러 발생**
   - .hwp 확장자 파일을 gethwp.read_hwpx()로 처리
   - gethwp 라이브러리가 "Invalid HWPX file format" 예외 발생

### 2.3 에러 유형별 상세 분석

#### 2.3.1 .hwp 파일 에러 (77.9%)

**원인**: 확장자가 .hwp인 파일을 HWPX 포맷으로 읽으려는 시도

**발생 조건**:
- HWP5 포맷으로 읽기 실패
- gethwp.read_hwp()로 읽기 실패
- HWPX fallback 시도 시 gethwp.read_hwpx() 호출

**복구 가능성**: 높음
- 실제로는 처리 가능한 HWP 파일일 수 있음
- 다른 방법(hwp5txt, unoconv 등)으로 시도 필요

#### 2.3.2 .hwpx 파일 에러 (22.1%)

**원인**: 실제로 손상되었거나 비표준 HWPX 파일

**발생 조건**:
- 확장자는 .hwpx이지만 gethwp.read_hwpx()가 읽을 수 없음
- 파일 손상, 비표준 포맷, 암호화 등

**복구 가능성**: 낮음
- 파일 자체의 문제일 가능성 높음
- 원본 파일 확인 필요

---

## 3. 사이트별 분포

### 3.1 상위 10개 사이트

| 사이트 코드 | 파일 수 | 비율 |
|------------|---------|------|
| tongyeong | 45 | 36.9% |
| gbgs | 11 | 9.0% |
| busan | 6 | 4.9% |
| yd | 6 | 4.9% |
| yeosu | 4 | 3.3% |
| wonju | 3 | 2.5% |
| 군포 | 2 | 1.6% |
| 부천 | 2 | 1.6% |
| 남양주 | 2 | 1.6% |
| gg | 2 | 1.6% |

**특이사항**:
- 통영(tongyeong)에서 45건으로 가장 많이 발생 (36.9%)
- 상위 3개 사이트가 전체의 50.8% 차지

---

## 4. 샘플 파일 목록

### 4.1 .hwp 파일 에러 샘플 (상위 20개)

| # | 파일명 | 사이트 | 폴더 |
|---|--------|--------|------|
| 1 | (20251031) 공시송달 공고문(해농바이오).hwp | tongyeong | 037_농지보전부담금 환급금 결정 통지 송달불능에 따른 공시송달 공고 |
| 2 | (3) 위치도 및 현장사진(113호).hwp | 도봉 | 009_거주불명등록자 행정상 관리주소 이전 직권조치결과 공고 |
| 3 | (붙임1)공개모집 공고문.hwp | tongyeong | 032_통영시 국공립어린이집 위탁운영자 모집 공고 |
| 4 | (붙임4)공통 심사기준표.hwp | tongyeong | 032_통영시 국공립어린이집 위탁운영자 모집 공고 |
| 5 | 2024년 유기질비료 지원사업 표준사업지침(2026년까지 동일).hwp | 군산 | 013_2026년 유기질비료 지원사업 신청 공고 |
| 6 | 2024년 항측 위반건축물 사전통지 공시송달 공고.hwp | ep | 015_2024년 항측 위반건축물 처분 사전통지 공시송달 공고 |
| 7 | 2025년 10월 공시송달 공고문.hwp | michuhol | 101_자동차손해배상보장법 위반 과태료 반송 우편물 공시송달 |
| 8 | 2025년 10월 지방세 체납자 압류통지서 공시송달 공고문.hwp | tongyeong | 002_2025년 지방세 체납자 10월 압류통지서 공시송달 |
| 9 | 2025년 2학기분 통영시 전입대학생 지원금 신청 공고문.hwp | tongyeong | 040_2025년 2학기분 통영시 전입대학생 지원금 신청 공고 |
| 10 | 2025년 4차 이용자 모집 공고문.hwp | tongyeong | 006_2025년 4차 지역사회서비스 투자사업 바우처 이용자 모집 공고 |
| 11 | 2025년 고래불 해맞이 축제 보조사업자 공모(병곡면).hwp | yd | 008_2025년 고래불 해맞이 축제 보조사업자 공모 |
| 12 | 2025년 영덕군 추기 소나무재선충병 방제사업 공고문.hwp | yd | 003_2025년 추기 소나무재선충병 방제명령 및 긴급방제사업 시행 공고 |
| 13 | 2025년 하반기 소나무재선충병 방제사업 시행 공고.hwp | 대전중 | 003_2025년 하반기 소나무재선충병 방제사업 시행 공고 |
| 14 | 2025년도 통영시 저소득 대학생 장학금 지원대상자 선발 공고.hwp | tongyeong | 062_2025년도 통영시 저소득 대학생 장학금 지원대상자 선발 공고 |
| 15 | 2025년도 통영시 저소득 주민자녀 장학금 지원대상자 선발 공고.hwp | tongyeong | 061_2025년도 통영시 저소득 주민자녀 장학금 지원대상자 선발 공고 |
| 16 | 2025년도 통영시 지역대학생 장학금 지원대상자 선발 공고.hwp | tongyeong | 060_2025년도 통영시 지역대학생 장학금 지원대상자 선발 공고 |
| 17 | 2026년 과수고품질시설현대화사업 추진계획(배포용).hwp | gbgs | 003_2026년 과수고품질시설현대화사업 신청 공고 |
| 18 | 2026년 군포1동 청사관리 기간제근로자 채용공고.hwp | 군포 | 008_2026년 군포1동 청사관리 및 구내식당 운영 기간제근로자 채용공고 |
| 19 | 2026년 제1단계 공공근로사업공고문.hwp | 해운대 | 002_「2026년 1단계 공공근로사업」참여자 모집 공고 |
| 20 | 2026년 주민자치센터 프로그램 강사 모집 공고문(안).hwp | tongyeong | 020_2026년 도천동 주민자치센터 건강체조 강사 모집 |

### 4.2 .hwpx 파일 에러 샘플 (상위 20개)

| # | 파일명 | 사이트 | 폴더 |
|---|--------|--------|------|
| 1 | (붙임5) 서약서.hwpx | 서초 | 010_「방배동 2762-4 복합시설 신축공사」안전점검 수행기관 지정 공고 |
| 2 | 2025 구명조끼 보급 한시 지원사업(안) 변경 공고(2차).hwpx | sacheon | 113_[사천시공고제2025-1507호]2025년구명조끼한시보급지원사업대상자모집변경공고 |
| 3 | 2025-901_제안요청서[2026년 경기민원24 등 시스템 운영 및 유지관리용역].hwpx | gg | 068_2026년 경기민원24 등 시스템 운영 및 유지관리용역 |
| 4 | 202509 2025년도 외국인 계절근로자 프로그램 기본계획.hwpx | gjcity | 091_2026년 상반기 외국인 계절근로자 프로그램 참여자 신청 접수 안내 |
| 5 | 2025년 10월 말 기준 결혼중개업체 현황.hwpx | tongyeong | 029_2025년 10월 말 기준 결혼중개업체 현황 공시 |
| 6 | 2025년 농기계임대사업소 기간제근로자 채용 재공고(8회차).hwpx | yd | 003_2025년 영덕군 역사문화유산 학술세미나 개최 안내 |
| 7 | 2025년 민방위 사이버교육통지서（2차보충） 반송에 따른 공시송달 공고（단계동）.hwpx | wonju | 017_2025년 민방위 사이버교육（2차보충） 통지서 반송에 따른 공시송달 공고 |
| 8 | 2025년 민방위 집합교육통지서（2차보충） 반송에 따른 공시송달 공고（단계동）.hwpx | wonju | 067_2025년 민방위 집합교육（2차보충）통지서 반송에 따른 공시송달 공고 |
| 9 | 2025년 성범죄 경력자 취업 점검결과 공개표(통영시).hwpx | tongyeong | 057_2025년 어린이집 성범죄경력자 점검 확인 결과 공개 |
| 10 | 2026년 과수고품질시설현대화사업 신청 계획 공고.hwpx | gbgs | 003_2026년 과수고품질시설현대화사업 신청 공고 |
| 11 | [붙임1] 공고문.hwpx | sb | 084_개발행위허가 제한 주민의견청취 공고 |
| 12 | ★ 2026년 청년농업인(청년창업형 후계농업경영인) 영농정착지원사업 시행지침(배포용).hwpx | gn | 079_2026년 청년농업인 영농정착지원사업 1차 선발 모집 공고 |
| 13 | ★ 2026년 청년농업인(청년창업형 후계농업경영인) 영농정착지원사업 시행지침(변경표시).hwpx | gwangyang | 116_2026년 청년농업인영농정착지원사업 1차 선발알림 |
| 14 | 강동구 결혼중개업체 현황(2025년 10월말 기준).hwpx | 가평 | 001_하천구역 점용허가 고시[유인○] |
| 15 | 공고문(2025년 울릉군 야생동물 농작물 피해 보상금 지원사업(2차)).hwpx | ulleung | 001_2025년 울릉군 야생동물 농작물 피해 보상금 지원 사 |
| 16 | 공고문.hwpx | 화성 | 013_동탄7동 4기 주민자치회 위원 공개모집 공고 |
| 17 | 공시송달 공고문(11_13).hwpx | jungnang | 006_주정차위반 과태료부과 사전통지서 반송분 공시송달 |
| 18 | 공시송달 공고문.hwpx | gg | 095_요양보호사 자격취소에 따른 행정처분 관련 청문실시 안내 공고 |
| 19 | 공시송달공고.hwpx | 남양주 | 032_지방세 체납자 관허사업 정지 및 허가 취소 예정사항 안내 반송분 공시송달 |
| 20 | 서울특별시 강동구 도로명주소 고시문[제2025_190호].hwpx | 강동 | 009_서울특별시 강동구 도로명주소 고시[2025. 11. 7.] |

---

## 5. 파일 경로 정보

### 5.1 경로 구조

```
/home/zium/moabojo/incremental/{source}/{date}/{site_code}/{folder_num}/attachments/{filename}

예시:
/home/zium/moabojo/incremental/eminwon/20251117/부산강서/002/attachments/강서구 달빛어린이병원참여의료기관공개모집.hwp
```

### 5.2 경로 확인된 파일 예시

| 파일명 | 사이트 | 폴더 번호 | 예상 경로 패턴 |
|--------|--------|----------|----------------|
| 공고문.hwp | 광주남 | 001 | */eminwon/*/광주남/001/attachments/공고문.hwp |
| 의견제출서.hwp | 괴산 | 003 | */eminwon/*/괴산/003/attachments/의견제출서.hwp |
| 고시문.hwp | 군포 | 001 | */eminwon/*/군포/001/attachments/고시문.hwp |
| 공시송달 공고.hwp | 고양 | 029 | */eminwon/*/고양/029/attachments/공시송달 공고.hwp |
| 공시송달 공고문.hwp | 담양 | 001 | */eminwon/*/담양/001/attachments/공시송달 공고문.hwp |
| 강서구 달빛어린이병원참여의료기관공개모집.hwp | 부산강서 | 002 | */eminwon/*/부산강서/002/attachments/강서구 달빛어린이병원참여의료기관공개모집.hwp |
| 고시문(안).hwp | 부천 | 004 | */eminwon/*/부천/004/attachments/고시문(안).hwp |
| 공시송달공고.hwpx | 남양주 | 032 | */eminwon/*/남양주/032/attachments/공시송달공고.hwpx |
| 공시송달공고.hwp | 남양주 | 032 | */eminwon/*/남양주/032/attachments/공시송달공고.hwp |
| 도로명주소 고시문.hwp | 수영 | 001 | */eminwon/*/수영/001/attachments/도로명주소 고시문.hwp |

---

## 6. 권장 사항

### 6.1 단기 해결방안

1. **HWPX fallback 로직 개선**
   - 현재: 모든 .hwp 파일에 대해 HWPX fallback 시도
   - 개선: 실제 파일 내용을 확인 후 HWPX 시도
   - 방법: 파일 헤더(magic number)로 포맷 판별

2. **추가 변환 도구 시도**
   - hwp5txt 명령줄 도구
   - unoconv (LibreOffice 기반)
   - hwp2pdf 후 PDF 텍스트 추출

### 6.2 중장기 해결방안

1. **파일 포맷 자동 감지**
   ```python
   def detect_hwp_format(file_path):
       with open(file_path, 'rb') as f:
           header = f.read(8)
           if header.startswith(b'PK'):  # ZIP format
               return 'HWPX'
           elif header.startswith(b'\xd0\xcf\x11\xe0'):  # OLE2
               return 'HWP5'
           else:
               return 'HWP3'
   ```

2. **에러 재시도 메커니즘**
   - 실패한 파일을 별도 큐에 저장
   - 주기적으로 다른 도구로 재시도
   - 성공률 추적 및 최적 도구 선택

### 6.3 모니터링 개선

1. **에러 분류 상세화**
   - 확장자와 실제 포맷 불일치
   - 파일 손상
   - 지원하지 않는 HWP 버전
   - 암호화된 파일

2. **성공률 추적**
   - 사이트별 변환 성공률
   - 도구별 변환 성공률
   - 시간대별 에러 발생 추이

---

## 7. 부록

### 7.1 데이터 소스

- **에러 로그**: `logs/app_error.log*` (23개 파일)
- **애플리케이션 로그**: `logs/app.log*` (최근 10개 파일 분석)
- **분석 기간**: 2025-10-01 ~ 2025-11-18

### 7.2 분석 방법론

1. 에러 로그에서 HWP/HWPX 관련 에러 추출
2. 에러 패턴별로 분류 및 통계
3. 애플리케이션 로그에서 파일 경로 정보 추출
4. 파일명과 경로 정보 매칭
5. 사이트별, 유형별 분포 분석

### 7.3 한계점

1. **파일 실제 존재 여부 미확인**
   - /home/zium/moabojo 디렉토리 접근 불가
   - 파일 타입 실제 검증 불가

2. **경로 정보 불완전**
   - 211개 파일 중 122개만 경로 확인 (57.8%)
   - 89개 파일은 로그에서 경로 정보 미발견

3. **에러 중복 카운트**
   - 동일 파일이 여러 번 처리되어 중복 에러 발생
   - 실제 문제 파일 수는 211개이지만 에러는 1,356건

---

## 8. 종합 결론

### 주요 발견

1. **대부분의 에러는 .hwp 파일을 HWPX로 처리하는 로직 문제**
   - 160개의 .hwp 파일이 HWPX fallback에서 실패
   - 이는 코드 로직 개선으로 해결 가능

2. **실제 HWPX 포맷 에러는 소수**
   - 51개의 .hwpx 파일만 실제 포맷 문제
   - 전체 에러의 24.2%만 진짜 파일 문제

3. **특정 사이트에 집중**
   - 통영 사이트가 36.9%를 차지
   - 사이트별 맞춤 처리 필요 가능성

### 다음 단계

1. 파일 포맷 자동 감지 로직 구현
2. 추가 변환 도구 통합 (hwp5txt, unoconv)
3. 실패 파일 재시도 메커니즘 구축
4. 모니터링 대시보드 개선

---

**보고서 생성**: 2025-11-18 13:14:10
