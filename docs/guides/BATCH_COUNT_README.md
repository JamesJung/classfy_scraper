# ìŠ¤í¬ë˜í¼ URL ì¶”ì¶œ ë°°ì¹˜ ì‘ì—… ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ëª¨ë“  ìŠ¤í¬ë˜í¼ë¥¼ `--count` ì˜µì…˜ìœ¼ë¡œ ìë™ ì‹¤í–‰í•˜ì—¬ URLë§Œ ì¶”ì¶œí•˜ëŠ” ë°°ì¹˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- âœ… **156ê°œ ìŠ¤í¬ë˜í¼ ìë™ ì‹¤í–‰** - ëª¨ë“  ì‚¬ì´íŠ¸ì˜ URL ì¼ê´„ ì¶”ì¶œ
- âœ… **ë‚ ì§œ í•„í„°ë§** - íŠ¹ì • ë‚ ì§œ ì´í›„ ë˜ëŠ” íŠ¹ì • ì—°ë„ ê³µê³ ë§Œ ì¶”ì¶œ
- âœ… **ë¡œê·¸ ê¸°ë¡** - ì‹¤í–‰ ê²°ê³¼ ìƒì„¸ ë¡œê·¸ ì €ì¥
- âœ… **í†µê³„ ì œê³µ** - ì„±ê³µ/ì‹¤íŒ¨ ê±´ìˆ˜ ë° DB í†µê³„ ìë™ ì¡°íšŒ
- âœ… **í¬ë¡ íƒ­ ìë™í™”** - ì£¼ê¸°ì ìœ¼ë¡œ ìë™ ì‹¤í–‰

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ìˆ˜ë™ ì‹¤í–‰

```bash
# ì˜¤ëŠ˜ ë‚ ì§œ ì´í›„ ê³µê³  URL ì¶”ì¶œ (ê¸°ë³¸)
./batch_count_all_scrapers.sh

# íŠ¹ì • ë‚ ì§œ ì´í›„ ê³µê³  URL ì¶”ì¶œ
./batch_count_all_scrapers.sh 20241124
```

### 2. í¬ë¡ íƒ­ ì„¤ì¹˜ (ìë™í™”)

```bash
# ëŒ€í™”í˜• ì„¤ì¹˜
./install_crontab.sh

# ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ í¬ë¡ íƒ­ í¸ì§‘
crontab -e
```

---

## ğŸ“‚ íŒŒì¼ êµ¬ì„±

```
classfy_scraper/
â”œâ”€â”€ batch_count_all_scrapers.sh   # ë©”ì¸ ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ install_crontab.sh             # í¬ë¡ íƒ­ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ crontab_examples.txt           # í¬ë¡ íƒ­ ì„¤ì • ì˜ˆì‹œ
â”œâ”€â”€ BATCH_COUNT_README.md          # ì´ ë¬¸ì„œ
â””â”€â”€ logs/
    â””â”€â”€ batch_count/               # ë°°ì¹˜ ì‹¤í–‰ ë¡œê·¸
        â”œâ”€â”€ batch_count_2024-11-24_010000.log
        â””â”€â”€ ...
```

---

## ğŸ”§ ì‚¬ìš© ë°©ë²•

### batch_count_all_scrapers.sh

#### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
# ì˜¤ëŠ˜ ë‚ ì§œ ì´í›„ ê³µê³  ì¶”ì¶œ (ê¸°ë³¸ - íŒŒë¼ë¯¸í„° ì—†ìŒ)
./batch_count_all_scrapers.sh

# íŠ¹ì • ë‚ ì§œ ì´í›„ ê³µê³  ì¶”ì¶œ (--date 20241124)
./batch_count_all_scrapers.sh 20241124

# ì–´ì œ ë‚ ì§œë¶€í„° ê³µê³  ì¶”ì¶œ
./batch_count_all_scrapers.sh $(date -v-1d +%Y%m%d)
```

#### ì‹¤í–‰ íë¦„

1. **ì´ˆê¸°í™”**: ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±, ë°°ì¹˜ ë‚ ì§œ ì„¤ì •
2. **ìŠ¤í¬ë˜í¼ ìˆœíšŒ**: 156ê°œ ìŠ¤í¬ë˜í¼ íŒŒì¼ ìˆœì°¨ ì‹¤í–‰
3. **URL ì¶”ì¶œ**: ê° ìŠ¤í¬ë˜í¼ì—ì„œ `--count` ì˜µì…˜ìœ¼ë¡œ URLë§Œ ì¶”ì¶œ
4. **í†µê³„ ê¸°ë¡**: ì„±ê³µ/ì‹¤íŒ¨ ê±´ìˆ˜ ì§‘ê³„
5. **DB í†µê³„**: ìµœì¢… DB ì €ì¥ í˜„í™© ì¡°íšŒ

#### ì¶œë ¥ ì˜ˆì‹œ

```
================================================================================
  ëª¨ë“  ìŠ¤í¬ë˜í¼ URL ì¶”ì¶œ ë°°ì¹˜ ì‘ì—… ì‹œì‘
================================================================================
ë°°ì¹˜ ë‚ ì§œ: 2024-11-24
ëŒ€ìƒ ë‚ ì§œ: 20241124
ë¡œê·¸ íŒŒì¼: logs/batch_count/batch_count_2024-11-24_010530.log

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì²˜ë¦¬ ì¤‘ [1]: andong
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ andong ì™„ë£Œ (8ì´ˆ)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì²˜ë¦¬ ì¤‘ [2]: busan
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ busan ì™„ë£Œ (12ì´ˆ)

...

================================================================================
  ë°°ì¹˜ ì‘ì—… ì™„ë£Œ
================================================================================
ì „ì²´ ìŠ¤í¬ë˜í¼: 150ê°œ
ì„±ê³µ: 148ê°œ
ì‹¤íŒ¨: 2ê°œ
ì œì™¸: 6ê°œ

ì‹¤íŒ¨í•œ ìŠ¤í¬ë˜í¼ ëª©ë¡:
  - site_a
  - site_b

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DB í†µê³„ (batch_date: 2024-11-24)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì‚¬ì´íŠ¸      ì „ì²´    ì™„ë£Œ    ëŒ€ê¸°
andong      150     0       150
busan       87      0       87
...

ì´ URL ìˆ˜   ì™„ë£Œ    ëŒ€ê¸°    ì™„ë£Œìœ¨(%)
12,543      0       12,543  0.00
```

---

## â° í¬ë¡ íƒ­ ì„¤ì •

### ë¹ ë¥¸ ì„¤ì¹˜

```bash
./install_crontab.sh
```

ëŒ€í™”í˜• ë©”ë‰´ì—ì„œ ì›í•˜ëŠ” ìŠ¤ì¼€ì¤„ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤.

### ìˆ˜ë™ ì„¤ì •

#### 1. í¬ë¡ íƒ­ í¸ì§‘

```bash
crontab -e
```

#### 2. ì›í•˜ëŠ” ìŠ¤ì¼€ì¤„ ì¶”ê°€

```bash
# ë§¤ì¼ ì˜¤ì „ 1ì‹œ - ë‹¹ì¼ ê³µê³  URL ì¶”ì¶œ (ì¶”ì²œ)
0 1 * * * cd /Users/jin/classfy_scraper && ./batch_count_all_scrapers.sh $(date +\%Y\%m\%d) >> logs/cron_daily.log 2>&1

# ë§¤ì¼ ì˜¤ì „ 9ì‹œ, ì˜¤í›„ 6ì‹œ - ë‹¹ì¼ ê³µê³  URL ì¶”ì¶œ
0 9,18 * * * cd /Users/jin/classfy_scraper && ./batch_count_all_scrapers.sh $(date +\%Y\%m\%d) >> logs/cron_twice_daily.log 2>&1

# 6ì‹œê°„ë§ˆë‹¤ - ë‹¹ì¼ ê³µê³  URL ì¶”ì¶œ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§)
0 */6 * * * cd /Users/jin/classfy_scraper && ./batch_count_all_scrapers.sh $(date +\%Y\%m\%d) >> logs/cron_6hours.log 2>&1

# ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 3ì‹œ - í˜„ì¬ ì—°ë„ ì „ì²´ ê³µê³  URL ì¶”ì¶œ
0 3 * * 1 cd /Users/jin/classfy_scraper && ./batch_count_all_scrapers.sh >> logs/cron_weekly.log 2>&1
```

ë” ë§ì€ ì˜ˆì‹œëŠ” `crontab_examples.txt` íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.

#### 3. ì €ì¥ ë° í™•ì¸

```bash
# ì €ì¥ (vi í¸ì§‘ê¸°)
:wq

# í¬ë¡ íƒ­ í™•ì¸
crontab -l
```

---

## ğŸ“Š ë¡œê·¸ í™•ì¸

### ë¡œê·¸ íŒŒì¼ ìœ„ì¹˜

```bash
logs/batch_count/batch_count_YYYY-MM-DD_HHMMSS.log
```

### ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸

```bash
# ìµœì‹  ë¡œê·¸ íŒŒì¼ í™•ì¸
tail -f logs/batch_count/$(ls -t logs/batch_count/ | head -1)

# íŠ¹ì • ë‚ ì§œ ë¡œê·¸ ê²€ìƒ‰
ls logs/batch_count/ | grep 2024-11-24
```

### ë¡œê·¸ ë¶„ì„

```bash
# ì„±ê³µí•œ ìŠ¤í¬ë˜í¼ ê°œìˆ˜
grep "âœ“.*ì™„ë£Œ" logs/batch_count/batch_count_2024-11-24_*.log | wc -l

# ì‹¤íŒ¨í•œ ìŠ¤í¬ë˜í¼ ëª©ë¡
grep "âœ—.*ì‹¤íŒ¨" logs/batch_count/batch_count_2024-11-24_*.log

# ì „ì²´ ì‹¤í–‰ ì‹œê°„
grep "ë°°ì¹˜ ì‘ì—…" logs/batch_count/batch_count_2024-11-24_*.log
```

---

## ğŸ” DB í†µê³„ í™•ì¸

### ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ ìë™ ì¶œë ¥

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ í†µê³„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤:

- ì‚¬ì´íŠ¸ë³„ URL ì¶”ì¶œ ê±´ìˆ˜
- ì „ì²´ URL ê±´ìˆ˜
- ìŠ¤í¬ë˜í•‘ ì™„ë£Œ/ëŒ€ê¸° ê±´ìˆ˜

### ìˆ˜ë™ DB ì¡°íšŒ

```sql
-- ì˜¤ëŠ˜ ì¶”ì¶œëœ URL í†µê³„
SELECT
    site_code AS 'ì‚¬ì´íŠ¸',
    COUNT(*) AS 'ì „ì²´',
    SUM(scraped) AS 'ì™„ë£Œ',
    SUM(1-scraped) AS 'ëŒ€ê¸°'
FROM scraper_detail_urls
WHERE batch_date = CURDATE()
GROUP BY site_code
ORDER BY site_code;

-- ì „ì²´ í†µê³„
SELECT
    COUNT(*) AS 'ì´ URL ìˆ˜',
    SUM(scraped) AS 'ì™„ë£Œ',
    SUM(1-scraped) AS 'ëŒ€ê¸°',
    ROUND(SUM(scraped) * 100.0 / COUNT(*), 2) AS 'ì™„ë£Œìœ¨(%)'
FROM scraper_detail_urls
WHERE batch_date = CURDATE();

-- íŠ¹ì • ì‚¬ì´íŠ¸ì˜ ì¶”ì¶œëœ URL ëª©ë¡
SELECT title, detail_url, list_date
FROM scraper_detail_urls
WHERE site_code = 'busan'
  AND batch_date = CURDATE()
ORDER BY created_at DESC
LIMIT 10;
```

---

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ì˜¤ë¥˜

```bash
# ì—ëŸ¬: Permission denied
chmod +x batch_count_all_scrapers.sh
chmod +x install_crontab.sh
```

### ë¬¸ì œ 2: í¬ë¡ íƒ­ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

```bash
# í¬ë¡  ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ (Linux)
sudo systemctl status cron

# macOSì—ì„œëŠ” í¬ë¡ ì´ í•­ìƒ ì‹¤í–‰ ì¤‘ì´ë¯€ë¡œ ë¡œê·¸ í™•ì¸
grep CRON /var/log/system.log

# í¬ë¡ íƒ­ ê²½ë¡œ í™•ì¸
crontab -l | grep batch_count_all_scrapers
```

### ë¬¸ì œ 3: DB ì—°ê²° ì‹¤íŒ¨

```bash
# .env íŒŒì¼ í™•ì¸
cat .env | grep DB_

# DB ì—°ê²° í…ŒìŠ¤íŠ¸
mysql -h ${DB_HOST} -P ${DB_PORT} -u ${DB_USER} -p${DB_PASSWORD} ${DB_NAME} -e "SELECT 1;"
```

### ë¬¸ì œ 4: ì¼ë¶€ ìŠ¤í¬ë˜í¼ ì‹¤íŒ¨

ë¡œê·¸ì—ì„œ ì‹¤íŒ¨í•œ ìŠ¤í¬ë˜í¼ í™•ì¸ í›„ ê°œë³„ ì‹¤í–‰:

```bash
# ì‹¤íŒ¨í•œ ìŠ¤í¬ë˜í¼ë§Œ ê°œë³„ ì‹¤í–‰
node node/scraper/failed_site_scraper.js --site failed_site --date 20241124 --count
```

### ë¬¸ì œ 5: ë¡œê·¸ íŒŒì¼ì´ ë„ˆë¬´ í¼

```bash
# 30ì¼ ì´ìƒ ëœ ë¡œê·¸ ì‚­ì œ
find logs/batch_count -name "*.log" -type f -mtime +30 -delete

# ë˜ëŠ” í¬ë¡ íƒ­ì— ìë™ ì •ë¦¬ ì¶”ê°€
0 5 * * 0 find /Users/jin/classfy_scraper/logs -name "*.log" -type f -mtime +30 -delete
```

---

## âš™ï¸ ê³ ê¸‰ ì„¤ì •

### ë³‘ë ¬ ì‹¤í–‰

í˜„ì¬ëŠ” ìˆœì°¨ ì‹¤í–‰ì´ì§€ë§Œ, GNU Parallelì„ ì‚¬ìš©í•˜ì—¬ ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥:

```bash
# GNU Parallel ì„¤ì¹˜ (macOS)
brew install parallel

# ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
# ê¸°ì¡´: for scraper_file in *_scraper.js; do ... done
# ë³€ê²½: ls *_scraper.js | parallel -j 4 "node {} --site {.} --count"
```

### ì•Œë¦¼ ì„¤ì •

ë°°ì¹˜ ì‹¤í–‰ ì™„ë£Œ ì‹œ ì´ë©”ì¼ ë˜ëŠ” Slack ì•Œë¦¼:

```bash
# í¬ë¡ íƒ­ì— ì´ë©”ì¼ ì„¤ì •
MAILTO=your-email@example.com

# ë˜ëŠ” Slack Webhook ì¶”ê°€ (ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ëì—)
curl -X POST -H 'Content-type: application/json' \
  --data "{\"text\":\"ë°°ì¹˜ ì™„ë£Œ: ì„±ê³µ ${SUCCESS_COUNT}ê°œ, ì‹¤íŒ¨ ${FAILED_COUNT}ê°œ\"}" \
  https://hooks.slack.com/services/YOUR/WEBHOOK/URL
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [USAGE_GUIDE.md](./USAGE_GUIDE.md) - ê°œë³„ ìŠ¤í¬ë˜í¼ ì‚¬ìš© ê°€ì´ë“œ
- [SCRAPER_SYSTEMS_SUMMARY.md](./SCRAPER_SYSTEMS_SUMMARY.md) - ì „ì²´ ì‹œìŠ¤í…œ ì •ë¦¬
- [URL_EXTRACTION_README.md](./URL_EXTRACTION_README.md) - URL ì¶”ì¶œ ìƒì„¸ ê°€ì´ë“œ
- [crontab_examples.txt](./crontab_examples.txt) - í¬ë¡ íƒ­ ì„¤ì • ì˜ˆì‹œ

---

## ğŸ’¡ ê¶Œì¥ ì›Œí¬í”Œë¡œìš°

### 1ë‹¨ê³„: URL ì¶”ì¶œ (ë°°ì¹˜ ì‘ì—…)

```bash
# í¬ë¡ íƒ­ìœ¼ë¡œ ìë™ ì‹¤í–‰ ë˜ëŠ” ìˆ˜ë™ ì‹¤í–‰
./batch_count_all_scrapers.sh
```

### 2ë‹¨ê³„: í†µê³„ í™•ì¸

```sql
SELECT site_code, COUNT(*) as total
FROM scraper_detail_urls
WHERE batch_date = CURDATE()
GROUP BY site_code;
```

### 3ë‹¨ê³„: ì‹¤ì œ ìŠ¤í¬ë˜í•‘ (í•„ìš”ì‹œ)

```bash
# íŠ¹ì • ì‚¬ì´íŠ¸ë§Œ ìŠ¤í¬ë˜í•‘
node node/scraper/busan_scraper.js --site busan --year 2024
```

### 4ë‹¨ê³„: ì‹¤íŒ¨ ê³µê³  ì¬ì‹œë„ (í•„ìš”ì‹œ)

```bash
python3 retry_failed_announcements.py --site busan
```

---

## ğŸ“Š ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

- **ì‹¤í–‰ ì‹œê°„**: 156ê°œ ìŠ¤í¬ë˜í¼ Ã— í‰ê·  10ì´ˆ = ì•½ 26ë¶„
- **ì„œë²„ ë¶€í•˜**: ê° ìŠ¤í¬ë˜í¼ ì‚¬ì´ì— 2ì´ˆ ëŒ€ê¸° ì‹œê°„ ì„¤ì •ë¨
- **ë„¤íŠ¸ì›Œí¬**: ë¸Œë¼ìš°ì € ìë™í™”ë¡œ ì¸í•œ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê³ ë ¤
- **ë””ìŠ¤í¬**: ë¡œê·¸ íŒŒì¼ì´ ê³„ì† ì¦ê°€í•˜ë¯€ë¡œ ì£¼ê¸°ì  ì •ë¦¬ í•„ìš”

---

**ë°°ì¹˜ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!** ğŸ‰
