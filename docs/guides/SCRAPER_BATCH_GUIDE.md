# Scraper ë°ì´í„° ë°°ì¹˜ ì²˜ë¦¬ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

`data_dir` ë””ë ‰í† ë¦¬ì— ìˆëŠ” Scraper ë°ì´í„°ë¥¼ `site_type=Scraper`ë¡œ ë°°ì¹˜ ì²˜ë¦¬í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ¯ ì²˜ë¦¬ ëŒ€ìƒ

### data_dir êµ¬ì¡° (ë‚ ì§œë³„)
```
data_dir/
â”œâ”€â”€ 20251030/          â† ë‚ ì§œ ë””ë ‰í† ë¦¬ (YYYYMMDD í˜•ì‹)
â”‚   â”œâ”€â”€ kpc/           # í•œêµ­ìƒì‚°ì„±ë³¸ë¶€
â”‚   â”‚   â”œâ”€â”€ 001_ê³µê³ /
â”‚   â”‚   â””â”€â”€ 002_ê³µê³ /
â”‚   â”œâ”€â”€ reb/           # ê²½ê¸°ë„ê²½ì œê³¼í•™ì§„í¥ì›
â”‚   â”œâ”€â”€ bcci/          # ë¶€ì‚°ìƒê³µíšŒì˜ì†Œ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ 20251031/
â”‚   â”œâ”€â”€ kpc/
â”‚   â”œâ”€â”€ reb/
â”‚   â””â”€â”€ ...
â””â”€â”€ 20251101/
    â””â”€â”€ ...
```

**âš ï¸ ì¤‘ìš”**: ë‚ ì§œë³„ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. (zwave_scraperì˜ batch_output ìŠ¤íƒ€ì¼)

**ì´ 5,221ê°œ ê³µê³ **

### site_type ë§¤í•‘

| ë””ë ‰í† ë¦¬ | site_type | ì„¤ëª… |
|---------|-----------|------|
| `data_dir/20251030/kpc/` | **Scraper** | ë‚ ì§œë³„ ìŠ¤í¬ë˜í¼ ë°ì´í„° |
| `data_dir/20251030/reb/` | **Scraper** | ë‚ ì§œë³„ ìŠ¤í¬ë˜í¼ ë°ì´í„° |
| `data_dir/20251030/bcci/` | **Scraper** | ë‚ ì§œë³„ ìŠ¤í¬ë˜í¼ ë°ì´í„° |
| `data_dir/20251030/bizInfo/` | **api_scrap** | API ë°ì´í„° (ìë™ ë¶„ë¥˜) |
| `data_dir/20251030/kStartUp/` | **api_scrap** | API ë°ì´í„° (ìë™ ë¶„ë¥˜) |
| `data_dir/20251030/smes24/` | **api_scrap** | API ë°ì´í„° (ìë™ ë¶„ë¥˜) |

---

## ğŸš€ ì‚¬ìš©ë²•

### 1. ë‹¨ë… ì‹¤í–‰ (Scraperë§Œ)

```bash
# íŠ¹ì • ë‚ ì§œ ì²˜ë¦¬
python3 batch_scraper_to_pre_processor.py --source scraper --date 2025-10-30

# ì˜¤ëŠ˜ ë‚ ì§œ ì²˜ë¦¬
python3 batch_scraper_to_pre_processor.py --source scraper

# ì–´ì œ ë‚ ì§œ ì²˜ë¦¬
python3 batch_scraper_to_pre_processor.py --source scraper --yesterday

# ê°•ì œ ì¬ì²˜ë¦¬
python3 batch_scraper_to_pre_processor.py --source scraper --date 2025-10-30 --force

# ì²¨ë¶€íŒŒì¼ ê°•ì œ ì¬ì²˜ë¦¬
python3 batch_scraper_to_pre_processor.py --source scraper --date 2025-10-30 --force --attach-force

# ì›Œì»¤ ìˆ˜ ì¡°ì •
python3 batch_scraper_to_pre_processor.py --source scraper --date 2025-10-30 --workers 5
```

**âš ï¸ ì¤‘ìš”**: `--date` ì˜µì…˜ìœ¼ë¡œ ì²˜ë¦¬í•  ë‚ ì§œë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

### 2. ì „ìš© ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸

```bash
# Scraper ì „ìš© ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
bash run_batch_scraper_processor.sh

# ë˜ëŠ”
./run_batch_scraper_processor.sh
```

**ë¡œê·¸ ìœ„ì¹˜**: `logs/batch_scraper_processor_YYYYMMDD_HHMMSS.log`

### 3. í†µí•© ë°°ì¹˜ ì‹¤í–‰ (Eminwon + Homepage + Scraper)

```bash
# ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤ ì²˜ë¦¬
bash run_batch_pre_processor.sh

# ë˜ëŠ”
./run_batch_pre_processor.sh
```

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒ ìˆœì„œë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤:
1. Eminwon ë°ì´í„° (`eminwon_data_new/YYYY-MM-DD/`)
2. Homepage ë°ì´í„° (`scraped_incremental_v2/YYYY-MM-DD/`)
3. **Scraper ë°ì´í„°** (`data_dir/`)

**ë¡œê·¸ ìœ„ì¹˜**: `logs/batch_pre_processor_YYYYMMDD_HHMMSS.log`

---

## ğŸ“Š ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤

### 1ë‹¨ê³„: ë‚ ì§œ ë””ë ‰í† ë¦¬ ì„ íƒ
```
--date 2025-10-30
â†’ ë‚ ì§œ í˜•ì‹ ë³€í™˜: 2025-10-30 â†’ 20251030
â†’ base_dir = data_dir/20251030/
```

### 2ë‹¨ê³„: ë””ë ‰í† ë¦¬ ìŠ¤ìº”
```
data_dir/20251030/
â”œâ”€â”€ kpc/          â† site_code ìë™ ì¸ì‹
â”œâ”€â”€ reb/          â† site_code ìë™ ì¸ì‹
â”œâ”€â”€ bcci/         â† site_code ìë™ ì¸ì‹
â””â”€â”€ ...
```

### 3ë‹¨ê³„: site_type ê²°ì •
- `data_dir` ê²½ë¡œ ê°ì§€ â†’ `site_type = "Scraper"`
- API ì‚¬ì´íŠ¸ ìë™ ë¶„ë¥˜:
  - `kStartUp`, `bizInfo`, `smes24` â†’ `site_type = "api_scrap"`

### 4ë‹¨ê³„: ë³‘ë ¬ ì²˜ë¦¬
- ê¸°ë³¸ ì›Œì»¤ ìˆ˜: 3ê°œ
- ê° site_codeë³„ë¡œ ë³‘ë ¬ ì²˜ë¦¬
- `announcement_pre_processor.py` í˜¸ì¶œ

### 5ë‹¨ê³„: DB ì €ì¥
- í…Œì´ë¸”: `announcement_pre_processing`
- site_type: **Scraper** (ë˜ëŠ” api_scrap)
- ì¤‘ë³µ ì²´í¬ (url_key_hash ê¸°ë°˜)

---

## ğŸ“ ì¶œë ¥ ê²°ê³¼

### DB í…Œì´ë¸”: `announcement_pre_processing`

| ì»¬ëŸ¼ | ê°’ ì˜ˆì‹œ |
|------|--------|
| `site_type` | **Scraper** |
| `site_code` | bcci, jntp, uepa, gcon ë“± |
| `folder_name` | 001_ê³µê³ ì œëª© |
| `processing_status` | ì„±ê³µ, ì œì™¸, ì‹¤íŒ¨ |
| `origin_url` | https://... |
| `url_key` | bcci_... |
| `url_key_hash` | SHA256 í•´ì‹œ |

### ë¡œê·¸ íŒŒì¼ ì˜ˆì‹œ

```
================================================================================
SCRAPER ë°°ì¹˜ ì²˜ë¦¬ ì‹œì‘ - 2025-10-30
ë°ì´í„° ì†ŒìŠ¤: data_dir
================================================================================
ì²˜ë¦¬í•  ì§€ì—­: 13ê°œ
ë³‘ë ¬ ì›Œì»¤ ìˆ˜: 3ê°œ

ì²˜ë¦¬ ì§„í–‰ ì¤‘...
[ 7.7%] âœ… bcci                (  1ê°œ ê³µê³ ,   2.5ì´ˆ)
[15.4%] âœ… gcon                (109ê°œ ê³µê³ ,  45.3ì´ˆ)
[23.1%] âœ… gitct               (162ê°œ ê³µê³ ,  67.8ì´ˆ)
...

================================================================================
ì²˜ë¦¬ ì™„ë£Œ - ìµœì¢… í†µê³„
================================================================================
ë°ì´í„° ì†ŒìŠ¤: SCRAPER
ì „ì²´ ì§€ì—­: 13ê°œ
ì²˜ë¦¬ ì™„ë£Œ: 13ê°œ
  - ì„±ê³µ: 13ê°œ
  - ì‹¤íŒ¨: 0ê°œ
  - ìŠ¤í‚µ: 0ê°œ
ì „ì²´ ê³µê³  ìˆ˜: 5,221ê°œ
ì²˜ë¦¬ ì‹œê°„: 234.5ì´ˆ (3.9ë¶„)
í‰ê·  ì²˜ë¦¬ ì‹œê°„: 18.0ì´ˆ/ì§€ì—­
================================================================================
```

---

## âš™ï¸ ì„¤ì •

### ë³‘ë ¬ ì²˜ë¦¬ ì›Œì»¤ ìˆ˜

| ì›Œì»¤ ìˆ˜ | ê¶Œì¥ ì‚¬ìš© ì‹œì  | ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„ |
|--------|-------------|-------------|
| 1ê°œ | ë””ë²„ê¹…, ì•ˆì •ì„± ìš°ì„  | ~10ë¶„ |
| 3ê°œ (ê¸°ë³¸) | ì¼ë°˜ì ì¸ ë°°ì¹˜ ì²˜ë¦¬ | ~5ë¶„ |
| 5ê°œ | ë¹ ë¥¸ ì²˜ë¦¬ í•„ìš” ì‹œ | ~3ë¶„ |

```bash
# ì›Œì»¤ ìˆ˜ ì¡°ì •
python3 batch_scraper_to_pre_processor.py --source scraper --workers 5
```

### ì¬ì²˜ë¦¬ ì˜µì…˜

```bash
# ì´ë¯¸ ì²˜ë¦¬ëœ í•­ëª©ë„ ë‹¤ì‹œ ì²˜ë¦¬
--force

# ì²¨ë¶€íŒŒì¼ ê°•ì œ ì¬ì²˜ë¦¬ (ê¸°ì¡´ .md íŒŒì¼ ë¬´ì‹œ)
--attach-force
```

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ë‚ ì§œ ë””ë ‰í† ë¦¬ ì—†ìŒ
```
âŒ ë‚ ì§œ ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: data_dir/20251030
ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œ: 20251029, 20251028, 20251027
```

**í•´ê²°**:
```bash
# ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œ í™•ì¸
ls -la data_dir/

# ì˜¬ë°”ë¥¸ ë‚ ì§œë¡œ ë‹¤ì‹œ ì‹¤í–‰
python3 batch_scraper_to_pre_processor.py --source scraper --date 2025-10-29
```

### ë¬¸ì œ 2: site_typeì´ Unknownìœ¼ë¡œ ì €ì¥ë¨
```
âš ï¸ site_typeì„ ê²°ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
```

**ì›ì¸**: `determine_site_type()` í•¨ìˆ˜ê°€ "data_dir"ì„ ì¸ì‹í•˜ì§€ ëª»í•¨

**í•´ê²°**: `announcement_pre_processor.py` ì—…ë°ì´íŠ¸ í™•ì¸
```python
elif "data_dir" in directory_name.lower():
    return "Scraper"
```

### ë¬¸ì œ 3: API ì‚¬ì´íŠ¸ê°€ Scraperë¡œ ì €ì¥ë¨
```
kStartUpì´ site_type=Scraperë¡œ ì €ì¥ë¨ (ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ)
```

**ì›ì¸**: API ì‚¬ì´íŠ¸ ì²´í¬ê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•¨

**í•´ê²°**: `determine_site_type()` í•¨ìˆ˜ì—ì„œ API ì‚¬ì´íŠ¸ ì²´í¬ê°€ ìµœìš°ì„ ìœ¼ë¡œ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
```python
# íŠ¹ìˆ˜ API ì‚¬ì´íŠ¸ ì²´í¬ (ìµœìš°ì„ )
if site_code in ["kStartUp", "bizInfo", "smes24"]:
    return "api_scrap"
```

---

## ğŸ“ˆ ì„±ëŠ¥

### ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„ (ì›Œì»¤ 3ê°œ ê¸°ì¤€)

| site_code | ê³µê³  ìˆ˜ | ì˜ˆìƒ ì‹œê°„ |
|-----------|--------|----------|
| bcci | 1 | ~3ì´ˆ |
| gcon | 109 | ~45ì´ˆ |
| gitct | 162 | ~70ì´ˆ |
| jntp1 | 203 | ~85ì´ˆ |
| uepa | 182 | ~75ì´ˆ |
| kStartUp | 3103 | ~15ë¶„ |
| smes24 | 1291 | ~8ë¶„ |

**ì „ì²´ ì˜ˆìƒ ì‹œê°„**: ì•½ **25-30ë¶„**

---

## ğŸ›ï¸ Cron ìŠ¤ì¼€ì¤„ë§

### ë§¤ì¼ ìë™ ì‹¤í–‰

```bash
# crontab í¸ì§‘
crontab -e

# Scraper ë°°ì¹˜ë¥¼ ë§¤ì¼ ìƒˆë²½ 3ì‹œì— ì‹¤í–‰
0 3 * * * /home/zium/classfy_scraper/run_batch_scraper_processor.sh

# ë˜ëŠ” í†µí•© ë°°ì¹˜ ì‹¤í–‰
0 3 * * * /home/zium/classfy_scraper/run_batch_pre_processor.sh
```

---

## ğŸ“š ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ì„¤ëª… |
|-----|------|
| `batch_scraper_to_pre_processor.py` | í†µí•© ë°°ì¹˜ ì²˜ë¦¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° (ìˆ˜ì •ë¨) |
| `run_batch_scraper_processor.sh` | Scraper ì „ìš© ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (ì‹ ê·œ) |
| `run_batch_pre_processor.sh` | í†µí•© ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (ì—…ë°ì´íŠ¸ë¨) |
| `announcement_pre_processor.py` | ê³µê³  ì‚¬ì „ ì²˜ë¦¬ í”„ë¡œê·¸ë¨ (ì—…ë°ì´íŠ¸ë¨) |

---

## âœ… ë³€ê²½ ì‚¬í•­ ìš”ì•½

### 1. `batch_scraper_to_pre_processor.py`
- `--source scraper` ì˜µì…˜ ì¶”ê°€
- `data_dir` ê²½ë¡œ ì§€ì›

### 2. `announcement_pre_processor.py`
- `determine_site_type()` í•¨ìˆ˜ì— "data_dir" ì²´í¬ ì¶”ê°€
- `"data_dir"` â†’ `site_type = "Scraper"`

### 3. `run_batch_pre_processor.sh`
- Scraper ë°ì´í„° ì²˜ë¦¬ ë‹¨ê³„ ì¶”ê°€ (3ë‹¨ê³„)

### 4. `run_batch_scraper_processor.sh` (ì‹ ê·œ)
- Scraper ì „ìš© ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸

---

## ğŸ’¡ íŒ

1. **ì²« ì‹¤í–‰ ì‹œ**: `--force` ì˜µì…˜ ì—†ì´ ì‹¤í–‰í•˜ì—¬ ì´ë¯¸ ì²˜ë¦¬ëœ í•­ëª© í™•ì¸
2. **ëŒ€ëŸ‰ ì¬ì²˜ë¦¬**: ì›Œì»¤ ìˆ˜ë¥¼ ëŠ˜ë¦¬ê³  `--force --attach-force` ì‚¬ìš©
3. **ë””ë²„ê¹…**: ì›Œì»¤ 1ê°œë¡œ ì‹¤í–‰í•˜ì—¬ ë¡œê·¸ í™•ì¸
4. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ë¡œê·¸ íŒŒì¼ì—ì„œ ì²˜ë¦¬ ì‹œê°„ í™•ì¸

---

**ì‘ì„±ì¼**: 2025-10-30
**ë²„ì „**: 1.0
